{
  "meta": {
    "featureId": "feature-001-support-ticket",
    "title": "Support Ticket Create",
    "version": "1.0.1",
    "createdAt": "2026-02-02"
  },
  "scope": {
    "inScope": [
      "Create ticket",
      "Validation",
      "Persist SupportTicket",
      "Return ticketNumber + status"
    ],
    "outOfScope": [
      "Update/close",
      "Attachments",
      "Email notifications"
    ]
  },
  "assumptions": [
    "Endpoint requires authenticated user (placeholder).",
    "Use JPA with relational database.",
    "Correlation id via X-Correlation-Id header or generated.",
    "Priority processing order: HIGH > MEDIUM > LOW (REQ-010)",
    "Tickets are processed in the order they are created, with priority influencing completion order.",
    "User session or token provides user identity for daily limits."
  ],
  "openQuestions": [
    "Link ticket to userId?",
    "Existing global error response standard?",
    "What is the exact mechanism for enforcing completion order (e.g., API endpoint for completion, or is this a background process)?"
  ],
  "requirements": [
    {
      "id": "REQ-001",
      "text": "User can create ticket with subject, description, priority.",
      "priority": "must"
    },
    {
      "id": "REQ-002",
      "text": "Subject is verplicht (min 5, max 120).",
      "priority": "must"
    },
    {
      "id": "REQ-003",
      "text": "Description is verplicht (min 20, max 2000).",
      "priority": "must"
    },
    {
      "id": "REQ-004",
      "text": "Priority is verplicht en één van: LOW, MEDIUM, HIGH.",
      "priority": "must"
    },
    {
      "id": "REQ-005",
      "text": "Na succesvol aanmaken krijgt gebruiker ticketNumber + status = OPEN te zien.",
      "priority": "must"
    },
    {
      "id": "REQ-006",
      "text": "Bij validatiefouten worden veldspecifieke fouten getoond.",
      "priority": "must"
    },
    {
      "id": "REQ-007",
      "text": "Server errors tonen generieke foutmelding met correlation id.",
      "priority": "must"
    },
    {
      "id": "REQ-008",
      "text": "Ticket subject must be unique per day (business constraint).",
      "priority": "must"
    },
    {
      "id": "REQ-009",
      "text": "A user can create at most 3 tickets per day.",
      "priority": "must"
    },
    {
      "id": "REQ-010",
      "text": "Tickets with priority HIGH must be completed before tickets with priority LOW.",
      "priority": "must"
    },
    {
      "id": "REQ-011",
      "text": "A ticket with priority HIGH must always be visible immediately after creation.",
      "priority": "must"
    },
    {
      "id": "REQ-012",
      "text": "A ticket with priority HIGH must always be completed before a ticket with priority MEDIUM.",
      "priority": "must"
    },
    {
      "id": "REQ-013",
      "text": "A user can create at most 2 tickets with the priority HIGH.",
      "priority": "should"
    }
  ],
  "domain": {
    "entities": [
      {
        "name": "SupportTicket",
        "fields": [
          {
            "name": "id",
            "type": "uuid"
          },
          {
            "name": "ticketNumber",
            "type": "string",
            "constraints": [
              "unique"
            ]
          },
          {
            "name": "subject",
            "type": "string",
            "constraints": [
              "min:5",
              "max:120",
              "uniquePerDay:true"
            ],
            "testCases": [
              "empty",
              "too_short",
              "too_long"
            ]
          },
          {
            "name": "description",
            "type": "string",
            "constraints": [
              "min:20",
              "max:2000"
            ],
            "testCases": [
              "empty",
              "too_short",
              "too_long"
            ]
          },
          {
            "name": "priority",
            "type": "enum:LOW|MEDIUM|HIGH",
            "testCases": [
              "missing",
              "invalid_value"
            ]
          },
          {
            "name": "status",
            "type": "enum:OPEN"
          },
          {
            "name": "createdAt",
            "type": "instant"
          },
          {
            "name": "userId",
            "type": "string",
            "constraints": [
              "required"
            ]
          },
          {
            "name": "highPriorityCount",
            "type": "integer",
            "constraints": [
              "max:2"
            ]
          }
        ]
      }
    ]
  },
  "api": {
    "errorFormat": {
      "type": "ApiError",
      "fields": [
        "correlationId",
        "code",
        "message",
        "fieldErrors"
      ]
    },
    "endpoints": [
      {
        "method": "POST",
        "path": "/api/tickets",
        "summary": "Create support ticket",
        "request": {
          "bodySchemaRef": "CreateTicketRequest",
          "validationRules": [
            "subject min 5 max 120",
            "description min 20 max 2000",
            "priority in LOW|MEDIUM|HIGH",
            "userId required",
            "highPriorityCount <= 2"
          ]
        },
        "responses": [
          {
            "status": 201,
            "bodySchemaRef": "CreateTicketResponse"
          },
          {
            "status": 400,
            "bodySchemaRef": "ApiError"
          },
          {
            "status": 409,
            "bodySchemaRef": "ApiError"
          },
          {
            "status": 500,
            "bodySchemaRef": "ApiError"
          }
        ],
        "auth": "authenticated"
      }
    ]
  },
  "backend": {
    "modules": [
      {
        "name": "tickets",
        "classes": [
          {
            "name": "TicketController",
            "responsibility": "REST endpoint mapping"
          },
          {
            "name": "TicketService",
            "responsibility": "Business logic"
          },
          {
            "name": "TicketNumberGenerator",
            "responsibility": "Generate ticket number"
          },
          {
            "name": "SupportTicketRepository",
            "responsibility": "Persistence"
          },
          {
            "name": "GlobalExceptionHandler",
            "responsibility": "Error handling"
          },
          {
            "name": "UserTicketLimitService",
            "responsibility": "Enforce daily ticket creation limits per user."
          },
          {
            "name": "PriorityCompletionEnforcer",
            "responsibility": "Ensures HIGH priority tickets are completed before LOW/MEDIUM."
          }
        ]
      }
    ]
  },
  "frontend": {
    "routes": [
      "/tickets/new"
    ],
    "components": [
      "TicketCreatePage",
      "TicketForm"
    ]
  },
  "tests": {
    "unit": [
      "TicketValidationTest",
      "TicketServiceTest",
      "UserTicketLimitServiceTest",
      "PriorityCompletionEnforcerTest"
    ],
    "integration": [
      "TicketControllerIT"
    ],
    "e2e": []
  },
  "traceability": [
    {
      "reqId": "REQ-009",
      "backendRefs": [
        "TicketService",
        "UserTicketLimitService"
      ],
      "frontendRefs": [
        "TicketForm"
      ],
      "testRefs": [
        "Feature001SupportTicketGeneratedIT"
      ]
    },
    {
      "reqId": "REQ-010",
      "backendRefs": [
        "TicketService",
        "PriorityCompletionEnforcer"
      ],
      "frontendRefs": [],
      "testRefs": []
    },
    {
      "reqId": "REQ-011",
      "backendRefs": [
        "TicketService"
      ],
      "frontendRefs": [
        "TicketCreatePage"
      ],
      "testRefs": []
    },
    {
      "reqId": "REQ-012",
      "backendRefs": [
        "TicketService",
        "PriorityCompletionEnforcer"
      ],
      "frontendRefs": [],
      "testRefs": []
    },
    {
      "reqId": "REQ-013",
      "backendRefs": [
        "TicketService",
        "UserTicketLimitService"
      ],
      "frontendRefs": [
        "TicketForm"
      ],
      "testRefs": []
    }
  ],
  "generatedTests": {
    "validationMatrix": {
      "SupportTicket.subject": [
        "empty",
        "too_short",
        "too_long"
      ],
      "SupportTicket.description": [
        "empty",
        "too_short",
        "too_long"
      ],
      "SupportTicket.priority": [
        "missing",
        "invalid_value"
      ],
      "SupportTicket.userId": [
        "missing"
      ],
      "SupportTicket.highPriorityCount": [
        "exceeds_limit"
      ]
    }
  }
}
