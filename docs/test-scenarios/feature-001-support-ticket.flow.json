{
  "meta": {
    "featureId": "feature-001-support-ticket",
    "version": "1.0.3"
  },
  "feature": "feature-001-support-ticket",
  "scenarios": [
    {
      "id": "create_ticket_happy_path",
      "title": "User creates a valid support ticket",
      "type": "happy-path"
    },
    {
      "id": "create_ticket_missing_subject",
      "title": "Ticket creation fails when subject is missing",
      "type": "validation"
    },
    {
      "id": "create_ticket_invalid_priority",
      "title": "Ticket creation fails when priority is invalid",
      "type": "validation"
    },
    {
      "id": "create_ticket_duplicate_subject_same_day",
      "title": "Ticket creation fails when subject already exists for the same day",
      "type": "validation"
    },
    {
      "id": "create_ticket_high_priority_visible_immediately",
      "title": "HIGH priority ticket visible immediately after creation",
      "type": "happy-path"
    },
    {
      "id": "create_ticket_limit_3_per_day",
      "title": "Ticket creation fails when user exceeds 3 tickets in one day",
      "type": "validation"
    },
    {
      "id": "ticket_priority_completion_order",
      "title": "HIGH priority tickets are completed before LOW priority tickets",
      "type": "happy-path"
    },
    {
      "id": "br_a_ticket_with_priority_high_must_always_be_visible_immediate",
      "title": "Business rule: A ticket with priority HIGH must always be visible immediately after creation.",
      "type": "validation"
    },
    {
      "id": "br_ticket_subject_must_be_unique_per_day_business_constraint",
      "title": "Business rule: Ticket subject must be unique per day (business constraint).",
      "type": "validation"
    },
    {
      "id": "br_user_can_only_add_3_tickets_per_day",
      "title": "Business rule: User can only add 3 tickets per day",
      "type": "validation"
    },
    {
      "id": "br_a_ticket_with_priority_high_must_always_be_completed_before_",
      "title": "Business rule: A ticket with priority HIGH must always be completed before a ticket with priority LOW",
      "type": "validation"
    },
    {
      "id": "create_ticket_limit_2_high_priority_per_user",
      "title": "Ticket creation fails when user exceeds 2 HIGH priority tickets per day.",
      "type": "validation"
    },
    {
      "id": "ticket_priority_completion_order_high_vs_medium",
      "title": "HIGH priority tickets are completed before MEDIUM priority tickets",
      "type": "happy-path"
    },
    {
      "id": "REQ-014-high-priority-visible-immediately",
      "title": "REQ-014: A ticket with priority HIGH must always be visible immediately after creation.",
      "type": "happy-path"
    },
    {
      "id": "REQ-015-unique-subject-per-day",
      "title": "REQ-015: Ticket subject must be unique per day.",
      "type": "validation"
    },
    {
      "id": "REQ-016-max-3-tickets-per-day",
      "title": "REQ-016: User can create at most 3 tickets per day.",
      "type": "validation"
    },
    {
      "id": "REQ-017-max-2-high-priority-per-day",
      "title": "REQ-017: User can create at most 2 tickets with the priority HIGH.",
      "type": "validation"
    },
    {
      "id": "REQ-018-high-priority-completion-before-low",
      "title": "REQ-018: A ticket with priority HIGH must always be completed before a ticket with priority LOW.",
      "type": "validation"
    },
    {
      "id": "REQ-019-high-priority-completion-before-medium",
      "title": "REQ-019: A ticket with priority HIGH must always be completed before a ticket with priority MEDIUM.",
      "type": "validation"
    },
    {
      "id": "REQ-020-high-priority-visible-immediately",
      "title": "REQ-020: A ticket with priority HIGH must always be visible immediately after creation.",
      "type": "happy-path"
    },
    {
      "id": "REQ-021-unique-subject-per-day",
      "title": "REQ-021: Ticket subject must be unique per day.",
      "type": "validation"
    },
    {
      "id": "REQ-022-max-3-tickets-per-day",
      "title": "REQ-022: User can create at most 3 tickets per day.",
      "type": "validation"
    },
    {
      "id": "REQ-023-max-2-high-priority-per-day",
      "title": "REQ-023: User can create at most 2 tickets with the priority HIGH.",
      "type": "validation"
    },
    {
      "id": "REQ-024-high-priority-completion-before-low",
      "title": "REQ-024: A ticket with priority HIGH must always be completed before a ticket with priority LOW.",
      "type": "validation"
    },
    {
      "id": "REQ-025-high-priority-completion-before-medium",
      "title": "REQ-025: A ticket with priority HIGH must always be completed before a ticket with priority MEDIUM.",
      "type": "validation"
    }
  ],
  "flows": [
    {
      "id": "FLOW-001",
      "name": "Happy path â€” create ticket",
      "preconditions": [
        "User authenticated",
        "API available"
      ],
      "steps": [
        {
          "actor": "user",
          "action": "Navigate to /tickets/new",
          "expected": "Form shown with subject/description/priority, submit disabled"
        },
        {
          "actor": "user",
          "action": "Enter subject 'Cannot login to portal'",
          "expected": "Subject valid"
        },
        {
          "actor": "user",
          "action": "Enter description with >= 20 characters",
          "expected": "Description valid"
        },
        {
          "actor": "user",
          "action": "Select priority HIGH",
          "expected": "Priority valid, submit enabled"
        },
        {
          "actor": "user",
          "action": "Click Submit",
          "expected": "Loading indicator shown",
          "apiCalls": [
            "POST /api/tickets"
          ]
        },
        {
          "actor": "system",
          "action": "Return 201 CreateTicketResponse",
          "expected": "Success view shows ticketNumber and status OPEN"
        }
      ],
      "variants": [
        {
          "type": "negative",
          "name": "Subject too short",
          "steps": [
            {
              "actor": "user",
              "action": "Enter subject 'abc'",
              "expected": "Field error shown, submit disabled"
            }
          ]
        },
        {
          "type": "negative",
          "name": "Server error 500",
          "steps": [
            {
              "actor": "system",
              "action": "Return 500 ApiError with correlationId",
              "expected": "UI shows generic error with correlationId"
            }
          ]
        },
        {
          "type": "negative",
          "name": "User exceeds 3 tickets per day",
          "steps": [
            {
              "actor": "system",
              "action": "Reject ticket creation after 3 tickets created in same day",
              "expected": "400 with field error on limit"
            }
          ]
        },
        {
          "type": "negative",
          "name": "User exceeds 2 HIGH priority tickets per day",
          "steps": [
            {
              "actor": "system",
              "action": "Reject ticket creation when user already has 2 HIGH priority tickets today",
              "expected": "400 with field error on HIGH priority limit"
            }
          ]
        },
        {
          "type": "negative",
          "name": "LOW completed before HIGH is not allowed",
          "steps": [
            {
              "actor": "system",
              "action": "Attempt to complete a LOW ticket while a HIGH ticket is still open",
              "expected": "Operation rejected (409 or 400) with code PRIORITY_ORDER_VIOLATION (or similar)"
            }
          ]
        },
        {
          "type": "negative",
          "name": "MEDIUM completed before HIGH is not allowed",
          "steps": [
            {
              "actor": "system",
              "action": "Attempt to complete a MEDIUM ticket while a HIGH ticket is still open",
              "expected": "Operation rejected (409 or 400) with code PRIORITY_ORDER_VIOLATION (or similar)"
            }
          ]
        },
        {
          "type": "negative",
          "name": "HIGH priority ticket visible immediately",
          "steps": [
            {
              "actor": "user",
              "action": "Create a HIGH priority ticket",
              "expected": "Ticket is immediately visible in user's ticket list or dashboard."
            }
          ]
        },
        {
          "type": "negative",
          "name": "Subject uniqueness violation",
          "steps": [
            {
              "actor": "user",
              "action": "Attempt to create a ticket with a subject that already exists for the current day",
              "expected": "409 Conflict or 400 Bad Request with error message 'Subject must be unique per day.'"
            }
          ]
        },
        {
          "type": "negative",
          "name": "User exceeds max 3 tickets per day",
          "steps": [
            {
              "actor": "user",
              "action": "Create 3 tickets within the same day",
              "expected": "Successful creation of 3 tickets."
            },
            {
              "actor": "user",
              "action": "Attempt to create a 4th ticket on the same day",
              "expected": "API returns 400 Bad Request with error message indicating daily limit exceeded."
            }
          ]
        },
        {
          "type": "negative",
          "name": "User exceeds max 2 HIGH priority tickets per day",
          "steps": [
            {
              "actor": "user",
              "action": "Create 2 HIGH priority tickets within the same day",
              "expected": "Successful creation of 2 HIGH priority tickets."
            },
            {
              "actor": "user",
              "action": "Attempt to create a 3rd HIGH priority ticket on the same day",
              "expected": "API returns 400 Bad Request with error message indicating HIGH priority limit exceeded."
            }
          ]
        },
        {
          "type": "negative",
          "name": "HIGH priority ticket visible immediately after creation",
          "steps": [
            {
              "actor": "user",
              "action": "Create a HIGH priority ticket",
              "expected": "The newly created HIGH priority ticket is immediately visible in the user's ticket list or dashboard without requiring a refresh."
            }
          ]
        },
        {
          "type": "negative",
          "name": "Ticket subject must be unique per day",
          "steps": [
            {
              "actor": "user",
              "action": "Create a ticket with subject 'Issue with login'",
              "expected": "Ticket created successfully."
            },
            {
              "actor": "user",
              "action": "Attempt to create another ticket with the same subject 'Issue with login' on the same day",
              "expected": "API returns 409 Conflict or 400 Bad Request with error message 'Subject must be unique per day.'"
            }
          ]
        }
      ]
    }
  ]
}
